<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple Photo Editor</title>
  <style>
    :root{ --bg:#0f1724; --card:#0b1220; --muted:#9aa4b2; --accent:#06b6d4; }
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, Arial; background:linear-gradient(180deg,#071023,#071120); color:#e6eef6; margin:0; padding:24px;}
    .wrap{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:360px 1fr;gap:18px}
    .panel{background:rgba(255,255,255,0.03);border-radius:12px;padding:16px}
    h1{font-size:18px;margin:0 0 12px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=file]{width:100%}
    .controls{display:flex;flex-direction:column;gap:10px}
    .row{display:flex;gap:8px;align-items:center}
    .range-row{display:flex;align-items:center;gap:10px}
    input[type=range]{flex:1}
    button{background:var(--accent);border:none;color:#042023;padding:8px 10px;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .canvas-wrap{background:#071228;border-radius:12px;padding:12px;display:flex;flex-direction:column;align-items:center;min-height:520px}
    canvas{background:#021022;border-radius:6px;max-width:100%;height:auto}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .file-list{font-size:13px;color:var(--muted);}
    .hint{font-size:12px;color:var(--muted);margin-top:6px}
    .footer{margin-top:10px;display:flex;gap:8px}
    .btn-danger{background:#ff4d6d;color:#fff}
    .small{font-size:13px;padding:6px 8px}
    .crop-box{position:absolute;border:2px dashed rgba(255,255,255,0.6);pointer-events:none}
    @media (max-width:900px){.wrap{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <h1>Photo Editor (HTML / CSS / JS)</h1>
      <div class="controls">
        <div>
          <label>Upload image</label>
          <input id="file" type="file" accept="image/*">
          <div class="hint">Supported: PNG, JPG, GIF. Image is processed in your browser only.</div>
        </div>

        <div>
          <label>Basic transforms</label>
          <div class="row">
            <button id="rotateLeft" class="small">⟲ Rotate -90°</button>
            <button id="rotateRight" class="small">⟳ Rotate +90°</button>
            <button id="flipH" class="small">⇋ Flip H</button>
            <button id="flipV" class="small">⇅ Flip V</button>
          </div>
        </div>

        <div>
          <label>Crop</label>
          <div class="row">
            <button id="startCrop" class="small">Start Crop</button>
            <button id="applyCrop" class="small ghost">Apply Crop</button>
            <button id="cancelCrop" class="small ghost">Cancel</button>
          </div>
          <div class="hint">Drag on the image to select crop rectangle.</div>
        </div>

        <div>
          <label>Resize (px)</label>
          <div class="row">
            <input id="resizeW" type="number" placeholder="Width" style="width:110px;padding:6px;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
            <input id="resizeH" type="number" placeholder="Height" style="width:110px;padding:6px;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
            <button id="applyResize" class="small">Apply</button>
          </div>
        </div>

        <div>
          <label>Filters</label>
          <div class="range-row">
            <span style="width:70px">Brightness</span>
            <input id="brightness" type="range" min="0" max="200" value="100">
            <span id="brightnessVal">100%</span>
          </div>
          <div class="range-row">
            <span style="width:70px">Contrast</span>
            <input id="contrast" type="range" min="0" max="200" value="100">
            <span id="contrastVal">100%</span>
          </div>
          <div class="range-row">
            <span style="width:70px">Saturate</span>
            <input id="saturate" type="range" min="0" max="300" value="100">
            <span id="saturateVal">100%</span>
          </div>
          <div class="range-row">
            <label><input id="grayscale" type="checkbox"> Grayscale</label>
            <label style="margin-left:10px"><input id="invert" type="checkbox"> Invert</label>
          </div>
        </div>

        <div>
          <label>History & Export</label>
          <div class="row">
            <button id="undo" class="small ghost">Undo</button>
            <button id="reset" class="small ghost">Reset</button>
            <button id="download" class="small">Download</button>
            <button id="exportPNG" class="small">Export PNG</button>
          </div>
        </div>

        <div class="file-list">
          <div id="info">No image loaded</div>
        </div>
      </div>
    </div>

    <div class="panel canvas-wrap">
      <div style="position:relative;width:100%;display:flex;flex-direction:column;align-items:center;">
        <canvas id="canvas" width="800" height="500"></canvas>
        <div id="cropBox" class="crop-box" style="display:none"></div>
      </div>
      <div class="toolbar">
        <button id="fit" class="ghost small">Fit to screen</button>
        <button id="actual" class="ghost small">Actual size</button>
      </div>
      <div class="footer">
        <div style="color:var(--muted);font-size:13px">Tip: All edits happen in your browser. No uploads.</div>
      </div>
    </div>
  </div>

<script>
// Simple in-browser photo editor
const fileInput = document.getElementById('file');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const info = document.getElementById('info');
const cropBox = document.getElementById('cropBox');
let img = new Image();
let imgLoaded = false;
let stateStack = []; // store dataURLs
let currentState = null;
let transform = { rotate:0, flipH:false, flipV:false };
let filters = { brightness:100, contrast:100, saturate:100, grayscale:false, invert:false };
let cropping = false, cropStart=null, cropRect=null;

function pushState(){
  try{
    stateStack.push(canvas.toDataURL('image/png'));
    if(stateStack.length>30) stateStack.shift();
    updateUndo();
  }catch(e){console.warn('push state failed',e)}
}
function updateUndo(){ document.getElementById('undo').disabled = stateStack.length===0 }

function resetTransforms(){ transform = { rotate:0, flipH:false, flipV:false }; filters = { brightness:100, contrast:100, saturate:100, grayscale:false, invert:false }; document.getElementById('brightness').value=100;document.getElementById('contrast').value=100;document.getElementById('saturate').value=100;document.getElementById('grayscale').checked=false;document.getElementById('invert').checked=false; document.getElementById('brightnessVal').innerText='100%';document.getElementById('contrastVal').innerText='100%';document.getElementById('saturateVal').innerText='100%';}

function loadImageFromURL(url){ img = new Image(); img.crossOrigin='anonymous'; img.onload = ()=>{ imgLoaded=true; fitCanvasToImage(); drawImageToCanvas(); info.innerText = `Loaded: ${img.width} x ${img.height}`; stateStack=[]; pushState(); }
  img.src = url; }

fileInput.addEventListener('change', (e)=>{
  const f = e.target.files[0]; if(!f) return;
  const url = URL.createObjectURL(f);
  loadImageFromURL(url);
});

function fitCanvasToImage(){
  const maxW = Math.min(1000, window.innerWidth-420);
  const ratio = img.width / img.height;
  let w = Math.min(img.width, maxW);
  let h = Math.round(w / ratio);
  canvas.width = w; canvas.height = h;
}

function drawImageToCanvas(){
  // clear
  ctx.save();
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // apply pixel filters via ctx.filter
  const f = [];
  f.push(`brightness(${filters.brightness}%)`);
  f.push(`contrast(${filters.contrast}%)`);
  f.push(`saturate(${filters.saturate}%)`);
  if(filters.grayscale) f.push('grayscale(100%)');
  if(filters.invert) f.push('invert(100%)');
  ctx.filter = f.join(' ');

  // apply transforms: rotate/flip
  ctx.translate(canvas.width/2, canvas.height/2);
  const angle = transform.rotate * Math.PI/180;
  ctx.rotate(angle);
  const scaleX = transform.flipH ? -1 : 1;
  const scaleY = transform.flipV ? -1 : 1;
  ctx.scale(scaleX, scaleY);

  // draw image centered
  const drawW = canvas.width;
  const drawH = canvas.height;
  ctx.drawImage(img, -drawW/2, -drawH/2, drawW, drawH);

  ctx.restore();
}

// Controls
document.getElementById('rotateLeft').addEventListener('click', ()=>{ if(!imgLoaded) return; pushState(); transform.rotate = (transform.rotate - 90) % 360; drawImageToCanvas(); });
document.getElementById('rotateRight').addEventListener('click', ()=>{ if(!imgLoaded) return; pushState(); transform.rotate = (transform.rotate + 90) % 360; drawImageToCanvas(); });
document.getElementById('flipH').addEventListener('click', ()=>{ if(!imgLoaded) return; pushState(); transform.flipH = !transform.flipH; drawImageToCanvas(); });
document.getElementById('flipV').addEventListener('click', ()=>{ if(!imgLoaded) return; pushState(); transform.flipV = !transform.flipV; drawImageToCanvas(); });

// Resize
document.getElementById('applyResize').addEventListener('click', ()=>{
  if(!imgLoaded) return; const w = parseInt(document.getElementById('resizeW').value); const h = parseInt(document.getElementById('resizeH').value);
  if(!w || !h){ alert('Please enter width and height in pixels'); return; }
  pushState();
  // create temp canvas to redraw at new size
  const tmp = document.createElement('canvas'); tmp.width = w; tmp.height = h; const tctx = tmp.getContext('2d');
  // apply filters
  tctx.filter = ctx.filter;
  tctx.drawImage(canvas, 0, 0, w, h);
  canvas.width = w; canvas.height = h; ctx.clearRect(0,0,w,h);
  ctx.drawImage(tmp,0,0);
});

// Filters
function applyFilterValues(){ filters.brightness = parseInt(document.getElementById('brightness').value); filters.contrast = parseInt(document.getElementById('contrast').value); filters.saturate = parseInt(document.getElementById('saturate').value); filters.grayscale = document.getElementById('grayscale').checked; filters.invert = document.getElementById('invert').checked; document.getElementById('brightnessVal').innerText = filters.brightness + '%'; document.getElementById('contrastVal').innerText = filters.contrast + '%'; document.getElementById('saturateVal').innerText = filters.saturate + '%'; }
['brightness','contrast','saturate'].forEach(id=>document.getElementById(id).addEventListener('input', ()=>{ if(!imgLoaded) return; applyFilterValues(); drawImageToCanvas(); }));
['grayscale','invert'].forEach(id=>document.getElementById(id).addEventListener('change', ()=>{ if(!imgLoaded) return; applyFilterValues(); drawImageToCanvas(); }));

// Undo/reset/download
document.getElementById('undo').addEventListener('click', ()=>{
  if(stateStack.length===0) return; const last = stateStack.pop(); const image = new Image(); image.onload = ()=>{ canvas.width = image.width; canvas.height = image.height; ctx.clearRect(0,0,canvas.width,canvas.height); ctx.drawImage(image,0,0); updateUndo(); }
  image.src = last;
});

document.getElementById('reset').addEventListener('click', ()=>{
  if(!imgLoaded) return; resetTransforms(); fitCanvasToImage(); drawImageToCanvas(); stateStack=[]; updateUndo(); });

function downloadDataURL(dataURL, filename){ const a = document.createElement('a'); a.href = dataURL; a.download = filename || 'image.png'; a.click(); }

function exportCanvas(type='image/png'){ return canvas.toDataURL(type); }

document.getElementById('download').addEventListener('click', ()=>{ if(!imgLoaded) return; pushState(); const data = exportCanvas('image/jpeg'); downloadDataURL(data, 'edited.jpg'); });

document.getElementById('exportPNG').addEventListener('click', ()=>{ if(!imgLoaded) return; const data = exportCanvas('image/png'); downloadDataURL(data, 'edited.png'); });

// Fit / Actual
document.getElementById('fit').addEventListener('click', ()=>{ if(!imgLoaded) return; fitCanvasToImage(); drawImageToCanvas(); });
document.getElementById('actual').addEventListener('click', ()=>{ if(!imgLoaded) return; canvas.width = img.width; canvas.height = img.height; drawImageToCanvas(); });

// Crop: enable mouse selection over canvas
canvas.style.cursor = 'crosshair';
canvas.addEventListener('mousedown', (e)=>{
  if(!imgLoaded) return; if(!document.getElementById('startCrop').classList.contains('active')) return;
  cropping = true; const r = canvas.getBoundingClientRect(); cropStart = { x: e.clientX - r.left, y: e.clientY - r.top };
  cropRect = { x: cropStart.x, y: cropStart.y, w:0, h:0 };
  cropBox.style.display = 'block'; cropBox.style.left = (r.left + cropRect.x) + 'px'; cropBox.style.top = (r.top + cropRect.y) + 'px'; cropBox.style.width = '0px'; cropBox.style.height = '0px';
});

window.addEventListener('mousemove', (e)=>{
  if(!cropping) return; const r = canvas.getBoundingClientRect(); const x = Math.max(0, Math.min(canvas.width, e.clientX - r.left)); const y = Math.max(0, Math.min(canvas.height, e.clientY - r.top)); cropRect.w = x - cropStart.x; cropRect.h = y - cropStart.y;
  // position cropBox (in viewport coords)
  const left = r.left + Math.min(cropStart.x, cropStart.x + cropRect.w);
  const top = r.top + Math.min(cropStart.y, cropStart.y + cropRect.h);
  cropBox.style.left = left + 'px'; cropBox.style.top = top + 'px'; cropBox.style.width = Math.abs(cropRect.w) + 'px'; cropBox.style.height = Math.abs(cropRect.h) + 'px';
});

window.addEventListener('mouseup', (e)=>{
  if(!cropping) return; cropping = false; // selection finished
});

// Crop controls
const startCropBtn = document.getElementById('startCrop');
const applyCropBtn = document.getElementById('applyCrop');
const cancelCropBtn = document.getElementById('cancelCrop');
startCropBtn.addEventListener('click', ()=>{ if(!imgLoaded) return; startCropBtn.classList.toggle('active'); startCropBtn.innerText = startCropBtn.classList.contains('active') ? 'Crop: ON (drag)' : 'Start Crop'; applyCropBtn.style.display = startCropBtn.classList.contains('active') ? 'inline-block' : 'none'; cancelCropBtn.style.display = startCropBtn.classList.contains('active') ? 'inline-block' : 'none'; cropBox.style.display = 'none'; cropRect = null; });
applyCropBtn.addEventListener('click', ()=>{ if(!imgLoaded || !cropRect) return; pushState(); // normalize rect
  const sx = Math.round(Math.min(cropStart.x, cropStart.x + cropRect.w));
  const sy = Math.round(Math.min(cropStart.y, cropStart.y + cropRect.h));
  const sw = Math.round(Math.abs(cropRect.w));
  const sh = Math.round(Math.abs(cropRect.h));
  if(sw===0 || sh===0){ alert('No crop area selected'); return; }
  const tmp = document.createElement('canvas'); tmp.width = sw; tmp.height = sh; const tctx = tmp.getContext('2d');
  // draw current canvas area
  tctx.drawImage(canvas, sx, sy, sw, sh, 0, 0, sw, sh);
  canvas.width = sw; canvas.height = sh; ctx.clearRect(0,0,sw,sh); ctx.drawImage(tmp,0,0);
  cropBox.style.display='none'; startCropBtn.classList.remove('active'); applyCropBtn.style.display='none'; cancelCropBtn.style.display='none'; cropRect=null; });
cancelCropBtn.addEventListener('click', ()=>{ cropBox.style.display='none'; startCropBtn.classList.remove('active'); applyCropBtn.style.display='none'; cancelCropBtn.style.display='none'; cropRect=null; });

// Info update on resize
window.addEventListener('resize', ()=>{ if(imgLoaded) drawImageToCanvas(); });

// Initial UI state
applyCropBtn.style.display='none'; cancelCropBtn.style.display='none'; updateUndo();

// For convenience: load a demo image on double-click canvas (optional)
canvas.addEventListener('dblclick', ()=>{ if(imgLoaded) return; const demo = 'data:image/svg+xml;utf8,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="800" height="500"><rect width="100%" height="100%" fill="#123"/><text x="50%" y="50%" fill="#fff" font-size="28" text-anchor="middle" dominant-baseline="middle">Drop or upload an image to start</text></svg>'); loadImageFromURL(demo); });

// Helpful: allow drag & drop
window.addEventListener('dragover',(e)=>{ e.preventDefault(); });
window.addEventListener('drop',(e)=>{ e.preventDefault(); const f = e.dataTransfer.files && e.dataTransfer.files[0]; if(f && f.type.startsWith('image/')){ const url = URL.createObjectURL(f); loadImageFromURL(url); }});

</script>
</body>
</html>
